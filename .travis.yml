language: android
jdk: oraclejdk8

jobs:
  include:
#    - stage: prepare cache
#      script: true
    - stage: "Run checks of different versions"
    - script: ./gradlew --stacktrace check tests -PverboseReports -Pnet.twisterrob.test.android.pluginVersion=3.1.4 -Pnet.twisterrob.gradle.runner.gradleVersion=4.6
      name: "Android Gradle Plugin 3.1, Gradle 4.6"
    - script: ./gradlew --stacktrace check tests -PverboseReports -Pnet.twisterrob.test.android.pluginVersion=3.2.1 -Pnet.twisterrob.gradle.runner.gradleVersion=4.9
      name: "Android Gradle Plugin 3.2, Gradle 4.9"
    - script: ./gradlew --stacktrace check tests -PverboseReports -Pnet.twisterrob.test.android.pluginVersion=3.3.1 -Pnet.twisterrob.gradle.runner.gradleVersion=4.10.3
      name: "Android Gradle Plugin 3.3, Gradle 4.10.3"

android:
  licenses:
    - android-sdk-license-.+
  components:
    - tools
    - platform-tools
    # AGP's com.android.SdkConstants.CURRENT_BUILD_TOOLS_VERSION
    - build-tools-27.0.3 # 3.1
    - build-tools-28.0.3 # 3.2, 3.3
    # InstantAppExtension overrides compileSdkVersion, see android-all_kinds/build.gradle
    - android-27
    # compileSdkVersion for almost all tests
    - android-28

before_cache:
  # Don't cache lock files to prevent breaking future builds
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
  - rm -f  /tmp/.gradle-test-kit-travis/caches/modules-2/modules-2.lock
  - rm -fr /tmp/.gradle-test-kit-travis/caches/*/plugin-resolution/
  # Make cache smaller
  - rm -f  $HOME/.gradle/wrapper/dists/gradle-*/*/gradle-*.zip
  - rm -fr $HOME/.gradle/wrapper/dists/gradle-*/*/gradle-*/samples
  - rm -fr $HOME/.gradle/wrapper/dists/gradle-*/*/gradle-*/docs
  - rm -fr $HOME/.gradle/wrapper/dists/gradle-*/*/gradle-*/src
cache:
  directories:
    # Prevent "Downloading https://services.gradle.org/distributions/gradle-4.2.1-all.zip"
    # Prevent "Unzipping /home/travis/.gradle/wrapper/dists/gradle-4.2.1-all/domrskppdhf3wtn5mziw0c2zr/gradle-4.2.1-all.zip"
    - $HOME/.gradle/wrapper/dists/gradle-4.9-all/
    # Prevent "Download https://jcenter.bintray.com/" during compilation
    - $HOME/.gradle/caches/modules-2/
    # Prevent "Generating JAR file 'gradle-api-4.2.1.jar'" during compilation
    - $HOME/.gradle/caches/4.9/generated-gradle-jars/
    # Prevent "Download https://jcenter.bintray.com/" during test runs
    - /tmp/.gradle-test-kit-travis/caches/modules-2/
    # Prevent "Generating JAR file 'gradle-api-4.2.1.jar'" during test runs
    - /tmp/.gradle-test-kit-travis/caches/4.6/generated-gradle-jars/
    - /tmp/.gradle-test-kit-travis/caches/4.9/generated-gradle-jars/
    - /tmp/.gradle-test-kit-travis/caches/4.10.3/generated-gradle-jars/
    # Do not cache Android SDK, caching is done after SDK components are installed
    #- $ANDROID_HOME
